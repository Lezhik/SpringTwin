# I1.1 - Настроить Playwright для E2E тестов

## Метаданные задачи

| Поле | Значение |
|------|----------|
| **Название** | Настроить Playwright для E2E тестов (запускаются из Spring Boot тестов) |
| **Дата создания** | 2026-02-18 |
| **Статус** | Новая |
| **Приоритет** | High |
| **Спринт** | Sprint 1 |
| **Категория** | Infrastructure |

---

## Описание

Настроить Playwright для end-to-end тестирования приложения. Playwright запускается из Spring Boot тестов и обеспечивает:

1. Тестирование UI в реальном браузере (Chromium)
2. Автоматическое ожидание элементов
3. Headless режим по умолчанию
4. Скриншоты и трассировку
5. Интеграцию с Spring Boot через @SpringBootTest

### Структура тестов

- `src/test/java/twin/spring/e2e/app/` - Тесты для модуля app
- `src/test/java/twin/spring/e2e/project/` - Тесты для модуля project
- `src/test/java/twin/spring/e2e/architecture/` - Тесты для модуля architecture
- `src/test/java/twin/spring/e2e/analysis/` - Тесты для модуля analysis
- `src/test/java/twin/spring/e2e/report/` - Тесты для модуля report
- `src/test/java/twin/spring/e2e/mcp/` - Тесты для модуля mcp

---

## Mermaid диаграмма

```mermaid
graph TD
    subgraph Playwright Configuration
        playwright_config[PlaywrightConfiguration.java]
        test_config[TestNeo4jConfig.java]
    end
    
    subgraph Test Structure
        e2e[src/test/java/twin/spring/e2e/]
        app_tests[app/*E2ETest.java]
        project_tests[project/*E2ETest.java]
        architecture_tests[architecture/*E2ETest.java]
    end
    
    subgraph Test Execution
        spring_test[@SpringBootTest]
        random_port[RANDOM_PORT]
        playwright_api[Playwright Java API]
    end
    
    subgraph Infrastructure
        neo4j_embedded[Neo4j Embedded]
        chromium[Chromium Browser]
    end
    
    playwright_config --> e2e
    test_config --> neo4j_embedded
    
    e2e --> app_tests
    e2e --> project_tests
    e2e --> architecture_tests
    
    app_tests --> spring_test
    spring_test --> random_port
    spring_test --> neo4j_embedded
    app_tests --> playwright_api
    playwright_api --> chromium
</graph>
```

---

## DTO определения

Для данной задачи DTO не требуются, так как это инфраструктурная задача.

---

## Тестовые сценарии

### Unit тесты

| ID | Описание | Ожидаемый результат |
|----|----------|---------------------|
| UT-I1.1-01 | Проверка конфигурации Playwright | Конфигурация валидна |
| UT-I1.1-02 | Проверка PlaywrightConfiguration bean | Bean создается корректно |

### Интеграционные тесты

| ID | Описание | Шаги | Ожидаемый результат |
|----|----------|------|---------------------|
| IT-I1.1-01 | Запуск Playwright в headless режиме | 1. Запустить E2E тест | Тест проходит |
| IT-I1.1-02 | Интеграция с Spring Boot | 1. Выполнить `gradlew.bat test` | E2E тесты запускаются |
| IT-I1.1-03 | Интеграция с Neo4j Embedded | 1. Запустить E2E тест с БД | Данные сохраняются |

### E2E тесты

| ID | Описание | Шаги | Ожидаемый результат |
|----|----------|------|---------------------|
| E2E-I1.1-01 | Базовый тест приложения | 1. Открыть localhost:port<br>2. Проверить заголовок | Заголовок корректен |
| E2E-I1.1-02 | Тест навигации | 1. Открыть приложение<br>2. Кликнуть на пункт меню | Навигация работает |

---

## Критерии приемки

- [ ] Добавлена зависимость playwright в build.gradle.kts
- [ ] Создан PlaywrightConfiguration.java в src/test/java/twin/spring/config/
- [ ] Создан базовый абстрактный класс для E2E тестов
- [ ] Настроен @SpringBootTest с RANDOM_PORT
- [ ] Настроена интеграция с Neo4j Embedded через TestNeo4jConfig
- [ ] Создан пример E2E теста для главной страницы
- [ ] Настроены семантические селекторы (data-test, name, role)
- [ ] Команда `gradlew.bat test --tests "twin.spring.e2e.*"` выполняется успешно
- [ ] Playwright браузер запускается в headless режиме

---

## Зависимости

- **F1.1** - Настроить Vue.js проект в src/main/vue
- **F1.5** - Создать базовый layout и навигацию
- **I1.2** - Настроить Neo4j Embedded для тестов

---

## Примечания

- Использовать Playwright Java API (не Node.js)
- Playwright запускается из Spring Boot тестов через @SpringBootTest
- Использовать Chromium браузер в headless режиме
- Использовать data-test атрибуты для селекторов
- Использовать семантические селекторы: name, role
- Neo4j работает в embedded in-memory режиме для тестов
- Не требуется Docker для запуска тестов